(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/annex/vip_paid/index"],{"0e77":function(e,t,n){"use strict";n.r(t);var i=n("2549"),o=n("5965");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("7da8");var r=n("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"1d00f854",null,!1,i["a"],void 0);t["default"]=c.exports},2549:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,n=(e._self._c,!e.userInfo.is_ever_level&&e.userInfo.is_money_level?e._f("dateFormat")(e.userInfo.overdue_time):null),i=e.memberType.length,o=i?e.__map(e.memberType,(function(t,n){var i=e.__get_orig(t),o=e._f("moneyFormat")(t.pre_price),a="free"!==t.type&&"ever"!==t.type?e._f("moneyFormat")(t.price):null;return{$orig:i,f1:o,f2:a}})):null,a=e.memberCoupons.length,r=a?e.__map(e.memberCoupons,(function(t,n){var i=e.__get_orig(t),o=1!=t.coupon_type?parseFloat(t.coupon_price):null,a="0.00"!==t.use_min_price?e._f("moneyFormat")(t.use_min_price):null;return{$orig:i,m0:o,f3:a}})):null,c=e.goodsList.length;e.$mp.data=Object.assign({},{$root:{f0:n,g0:i,l0:o,g1:a,l1:r,g2:c}})},o=[]},"4d2c":function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("98d3");i(n("66fd"));var o=i(n("0e77"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},5965:function(e,t,n){"use strict";n.r(t);var i=n("5ecb"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},"5ecb":function(e,t,n){"use strict";(function(e){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("6a7c")),a=n("26cb"),r=n("7220"),c=n("aa99"),s=n("23b4"),u=n("60e3"),m=i(n("c5af")),p={components:{home:function(){Promise.all([n.e("common/vendor"),n.e("components/home/index")]).then(function(){return resolve(n("47cf"))}.bind(null,n)).catch(n.oe)},payment:function(){n.e("components/payment/index").then(function(){return resolve(n("fb51"))}.bind(null,n)).catch(n.oe)}},mixins:[o.default],filters:{dateFormat:function(e){return(0,m.default)(1e3*e).format("YYYY-MM-DD")},moneyFormat:function(e){return parseFloat(e)}},data:function(){return{memberType:[],userInfo:{},memberRights:[],memberExplain:[],memberCoupons:[],isGetFree:null,popupShow:!1,account:"",password:"",goodsList:[],pay_order_id:"",payMode:[{name:"微信支付",icon:"icon-weixinzhifu",value:"weixin",title:"微信快捷支付",payStatus:!0}],pay_close:!1,totalPrice:"0",formContent:"",page:1,limit:15,finished:!1,memberEndTime:"",type:"",svip:null}},watch:{popupShow:{immediate:!0,handler:function(){this.account="",this.password=""}}},computed:(0,a.mapGetters)(["isLogin"]),onLoad:function(){this.isLogin?(this.getOrderPayType(),this.memberCard(),this.groomList()):(0,s.toLogin)()},onReachBottom:function(){this.groomList()},methods:{onLunch:function(){this.getOrderPayType(),this.memberCard(),this.groomList()},pay:function(){"free"===this.type?this.createMemberCard("weixin"):this.pay_close=!0},scrollToCard:function(){var t=e.createSelectorQuery().in(this);t.select("#card").boundingClientRect((function(t){e.pageScrollTo({scrollTop:t.top})})).exec()},goDetail:function(t){e.navigateTo({url:"/pages/goods_details/index?id=".concat(t)})},memberCard:function(){var t=this;e.showLoading({title:"正在加载…"}),(0,r.memberCard)().then((function(n){e.hideLoading();var i=n.data,o=i.is_get_free,a=i.member_coupons,c=i.member_explain,s=i.member_rights,u=i.member_type;t.isGetFree=o,t.userInfo=o.user_info,t.memberRights=s,t.memberType=u,t.memberCoupons=a,t.memberExplain=c,o.is_record&&(t.memberType=t.memberType.filter((function(e){return"free"!==e.type}))),t.totalPrice=t.memberType[0].pre_price,t.type=t.memberType[0].type,t.totalPrice=t.memberType[0].pre_price,t.svip=t.memberType[0],(0,r.memberOverdueTime)({member_type:t.svip.type,vip_day:t.svip.vip_day}).then((function(e){t.memberEndTime=e.data.data}))})).catch((function(t){e.showToast({title:t,icon:"none"})}))},groomList:function(){var t=this;this.finished||(e.showLoading({title:"加载中"}),(0,r.groomList)(5,{page:this.page,limit:this.limit}).then((function(n){e.hideLoading(),t.goodsList=t.goodsList.concat(n.data.list),t.finished=n.data.list.length<t.limit,t.page+=1})).catch((function(t){e.hideLoading()})))},checkType:function(e){var t=this;this.type=e.type,this.svip=e,this.totalPrice=e.pre_price,(0,r.memberOverdueTime)({member_type:e.type,vip_day:e.vip_day}).then((function(e){t.memberEndTime=e.data.data}))},closePopup:function(){this.popupShow=!1},getMemberCard:function(){var e=this;(0,r.memberCard)().then((function(t){var n=t.data;e.memberType=n.member_type,e.memberRights=n.member_rights,e.isGetFree=n.is_get_free})).catch((function(e){}))},getOrderPayType:function(){var t=this;(0,c.orderOfflinePayType)().then((function(e){var n=e.data,i=(n.ali_pay_status,n.pay_weixin_open);t.payMode[0].payStatus=!!i})).catch((function(t){e.showToast({title:t,icon:"none"})}))},memberSelect:function(e){this.memberSelected=e},drawMemberCard:function(){var t={member_card_code:"",member_card_pwd:"",from:"weixinh5"};return this.popupShow?this.account?this.password?(t.from="routine",e.showLoading({title:"激活中"}),void(0,r.memberCardDraw)(t).then((function(t){e.showToast({title:t.msg,success:function(){this.popupShow=!1,this.getMemberCard()}})})).catch((function(t){e.showToast({title:t,icon:"none"})}))):e.showToast({title:"请输入卡密",icon:"none"}):e.showToast({title:"请输入卡号",icon:"none"}):this.popupShow=!0},createMemberCard:function(t){var n=this;e.showLoading({title:"正在加载…"});var i={pay_type:t||this.payMode[0].value,type:"1",from:"routine",member_type:this.svip.id,price:this.svip.pre_price,money:this.svip.price};(0,u.openPaySubscribe)().then((function(){(0,r.memberCardCreate)(i).then((function(t){if(!(parseFloat(n.svip.pre_price)>0))return e.hideLoading(),n.$util.Tips({title:"成功开启0元试用"},(function(){n.onLunch()}));n.callPay(t)})).catch((function(t){e.showToast({title:t,icon:"none"})}))}))},callPay:function(t){var n=t.data,i=n.status,o=n.result,a=(o.orderId,o.jsConfig);switch(i){case"ORDER_EXIST":case"EXTEND_ORDER":case"PAY_ERROR":e.hideLoading(),this.$util.Tips({title:t.msg},{tab:5,url:"/pages/annex/vip_paid/index"});break;case"SUCCESS":e.hideLoading(),this.$util.Tips({title:t.msg,icon:"success"},{tab:5,url:"/pages/annex/vip_paid/index"});break;case"WECHAT_PAY":e.requestPayment({timeStamp:a.timestamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:function(e){this.$util.Tips({title:"支付成功",icon:"success"},{tab:5,url:"/pages/annex/vip_paid/index"})},fail:function(){e.showToast({title:"取消支付",icon:"none"})},complete:function(){e.hideLoading()}});break;case"WECHAT_H5_PAY":e.showToast({title:t.msg,success:function(){location.href=a.mweb_url}});break;case"ALIPAY_PAY":e.hideLoading(),e.navigateTo({url:"/pages/users/alipay_invoke/index?id=".concat(t.data.result.order_id,"&link=").concat(a.qrCode,"&from=member")});break}},onChangeFun:function(e){var t=e,n=t.action||null,i=void 0!=t.value?t.value:null;n&&this[n]&&this[n](i)},payClose:function(){this.pay_close=!1},payCheck:function(e){this.createMemberCard(e)},checkForm:function(t){var n=this,i=t.detail.value,o={member_card_code:"",member_card_pwd:"",from:"H5 "};return i.account?i.password?(o.member_card_code=i.account,o.member_card_pwd=i.password,o.from="routine",e.showLoading({title:"激活中"}),void(0,r.memberCardDraw)(o).then((function(t){var i=n;e.showToast({title:t.msg,success:function(){i.popupShow=!1}})})).catch((function(t){e.showToast({title:t,icon:"none"})}))):e.showToast({title:"请输入卡密",icon:"none"}):e.showToast({title:"请输入卡号",icon:"none"})}}};t.default=p}).call(this,n("543d")["default"])},"6c06":function(e,t,n){},"7da8":function(e,t,n){"use strict";var i=n("6c06"),o=n.n(i);o.a}},[["4d2c","common/runtime","common/vendor"]]]);