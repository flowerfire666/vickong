(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/customer_list/chat"],{"0e30":function(t,e,i){},2487:function(t,e,i){"use strict";var n=i("3619"),o=i.n(n);o.a},"2c39":function(t,e,i){"use strict";var n=i("0e30"),o=i.n(n);o.a},3619:function(t,e,i){},"662a":function(t,e,i){},"88e2":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.orderId&&t.orderInfo.id&&t.orderInfo.cartInfo&&t.orderInfo.cartInfo?t.orderInfo.cartInfo.length:null),n=t.isSwiper&&t.httpUrl?t.emojiGroup.length:null;t._isMounted||(t.e0=function(e){t.isSwiper=!t.isSwiper}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:n}})},o=[]},"89d9":function(t,e,i){"use strict";i.r(e);var n=i("88e2"),o=i("c6cd");for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("2c39"),i("8ef7"),i("2487");var s=i("f0c5"),r=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=r.exports},"8ef7":function(t,e,i){"use strict";var n=i("662a"),o=i.n(n);o.a},a4db:function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("448a")),a=i("cc17"),s=i("7220"),r=i("a612"),c=i("aa99"),d=n(i("74b3")),u=n(i("6a7c")),l=getApp(),h=t.getSystemInfoSync().statusBarHeight+"px",f=function(t,e){e=1*e||1;var i=[];return t.forEach((function(t,n){n%e===0&&i.push([]),i[i.length-1].push(t)})),i},p={name:"adminChat_index",data:function(){return{httpUrl:"",status:!1,loading:!1,sysHead:h,isTool:!1,isSwiper:!1,isWords:!1,autoplay:!1,circular:!0,interval:3e3,duration:500,emojiGroup:f(d.default,21),wordsList:[],con:"",toUid:0,limit:15,upperId:0,chatList:[],kefuInfo:{},scrollTop:0,active:!0,isScroll:!0,oldHeight:0,myUid:0,productId:0,productInfo:{},orderId:0,page:1,orderInfo:{},uidTo:0,titleName:"",chatStatus:!1,userType:0,canvasWidth:"",canvasHeight:"",canvasStatus:!1,isReturen:0}},mixins:[u.default],components:{Loading:function(){i.e("components/Loading/index").then(function(){return resolve(i("ddb8"))}.bind(null,i)).catch(i.oe)}},computed:{isSend:function(){return 0!=this.con.length},records:function(){var t=this;return this.chatList.map((function(e,i){return i?e.add_time-t.chatList[i-1].add_time>=300?e.show=!0:e.show=!1:e.show=!0,e}))}},onLoad:function(t){this.isReturen=t.isReturen,this.myUid=this.$store.state.app.uid,this.toUid=t.to_uid,this.productId=parseInt(t.productId)||0,this.orderId=t.orderId||0,this.userType=t.type,this.getproductInfo(),this.getOrderInfo(),this.getChatList()},onUnload:function(){this.$socket.clearPing(),l.globalData.isWsOpen=!1,t.$off()},onReady:function(){var e=this;this.httpUrl="".concat(a.HTTP_REQUEST_URL,"/statics/images/look.png"),t.$on("to_transfer",(function(t){e.toUid=t.toUid,e.$socket.send({data:{id:e.toUid},type:"to_chat"}),e.chatList.forEach((function(i){i.uid!=e.myUid&&(i.avatar=t.avatar)}))})),t.$on("success",(function(){l.globalData.isWsOpen=!0,t.hideLoading(),e.$socket.send({data:{id:e.toUid},type:"to_chat"})})),t.$on(["reply","chat"],(function(t){1==t.msn_type&&(t.msn=e.replace_em(t.msn)),t._add_time=t._add_time.substring(0,t._add_time.length-3),e.chatList.push(t),e.$nextTick((function(){e.height()}))})),t.$on("socket_error",(function(){e.$util.Tips({title:"连接失败"})})),t.$on("err_tip",(function(t){e.$util.Tips({title:t.msg})})),t.$on("online",(function(e){0==e.online&&t.showModal({title:"提示",content:"客服已下线，是否需要反馈？",success:function(e){e.confirm?t.redirectTo({url:"/pages/columnGoods/HotNewGoods/feedback"}):e.cancel}})})),this.$nextTick((function(){e.height()}))},methods:{previewImage:function(e){t.previewImage({urls:[e]})},goBack:function(){t.navigateBack({delta:1,fail:function(){t.switchTab({url:"/pages/index/index"})}})},getproductInfo:function(){var t=this;this.productId&&(0,r.getProductDetail)(this.productId).then((function(e){t.productInfo=e.data.storeInfo}))},goProduct:function(e){t.navigateTo({url:"/pages/goods_details/index?id=".concat(e.msn)})},goOrder:function(e){this.userType?7==e.msn_type?t.navigateTo({url:"/pages/admin/orderDetail/index?id=".concat(e.msn,"&isReturen=1")}):t.navigateTo({url:"/pages/admin/orderDetail/index?id=".concat(e.msn)}):7==e.msn_type?t.navigateTo({url:"/pages/users/order_details/index?order_id=".concat(e.msn,"&isReturen=1")}):t.navigateTo({url:"/pages/users/order_details/index?order_id=".concat(e.msn)})},getOrderInfo:function(){var t=this;if(this.orderId){var e="";e=1==this.isReturen?(0,c.getRefundOrderDetail)(this.orderId):(0,c.getOrderDetail)(this.orderId),e.then((function(e){t.orderInfo=e.data,t.orderInfo.add_time_h&&(t.orderInfo.add_time_h=t.orderInfo.add_time_h.substring(0,t.orderInfo.add_time_h.lastIndexOf(":"))),t.orderInfo.cartInfo.length&&(t.cartInfo=t.orderInfo.cartInfo[0])}))}},addEmoji:function(t){var e="[".concat(t,"]");this.con+=e},replace_em:function(t){return t=t.replace(/\[em-([a-z_]*)\]/g,"<span class='em em-$1' style='background-image:url("+this.httpUrl+")'></span>"),t},getChatList:function(){var e=this;(0,s.getChatRecord)({limit:this.limit,uidTo:this.uidTo,toUid:this.toUid}).then((function(i){var n="";i.data.serviceList.length&&(n=0==e.uidTo?"#msg-".concat(i.data.serviceList[i.data.serviceList.length-1].id):"#msg-".concat(e.chatList[0].id));t.hideLoading(),t.setNavigationBarTitle({title:i.data.nickname}),e.titleName=i.data.nickname,e.toUid=i.data.uid,i.data.serviceList.forEach((function(t){t._add_time=t._add_time.substring(0,t._add_time.length-3),1!=t.msn_type&&2!=t.msn_type||(t.msn=e.replace_em(t.msn))})),e.loading=!1,e.chatList=[].concat((0,o.default)(i.data.serviceList),(0,o.default)(e.chatList)),l.globalData.isWsOpen||(t.showLoading({title:"客服连接中..."}),e.$socket.startConnect(),setTimeout((function(){t.hideLoading()}),5e3)),e.$nextTick((function(){e.setPageScrollTo(n),e.isScroll=i.data.serviceList.length>=e.limit}))})).catch((function(i){t.hideLoading(),e.$util.Tips({title:i}),e.loading=!1,e.isScroll=!1,t.redirectTo({url:"/pages/columnGoods/HotNewGoods/feedback"})}))},setPageScrollTo:function(e){var i=this;try{if(this.chatList.length){var n=t.createSelectorQuery().in(this).select(e);n.boundingClientRect((function(t){i.scrollTop=parseFloat(t.top)-60})).exec()}}catch(o){}},sendText:function(){if(!this.isSend||""===this.con.trim())return this.$util.Tips({title:"请输入内容"});this.sendMsg(this.con,1),this.con=""},sendMsg:function(t,e){this.$socket.send({data:{msn:t,type:e,to_uid:this.toUid},form_type:2,type:"chat"})},uploadImg:function(){var t=this,e=this;e.canvasStatus=!0,e.$util.uploadImageChange("upload/image",(function(t){200==t.status&&e.sendMsg(t.data.url,3)}),(function(e){t.canvasStatus=!1}),(function(e){t.canvasWidth=e.w,t.canvasHeight=e.h}))},sendProduct:function(){this.sendMsg(this.productId,5),this.productId=0,this.productInfo={}},sendOrder:function(){var t=0;t=1==this.isReturen?7:6,this.sendMsg(this.orderId,t),this.orderId=0,this.orderInfo={}},height:function(){var e=this,i=0,n=t.createSelectorQuery().select(".chat");setTimeout((function(t){n.boundingClientRect((function(t){i=t.height,e.active?e.scrollTop=parseInt(i)+500:e.scrollTop=parseInt(i)+100})).exec()}),200)},scrollToTop:function(){var t=this;this.isScroll&&(this.loading=!0,this.uidTo=this.chatList[0].id,this.isScroll=!1,setTimeout((function(e){t.getChatList()}),800))}}};e.default=p}).call(this,i("543d")["default"])},a64e:function(t,e,i){"use strict";(function(t,e){var n=i("4ea4");i("98d3");n(i("66fd"));var o=n(i("89d9"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},c6cd:function(t,e,i){"use strict";i.r(e);var n=i("a4db"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a}},[["a64e","common/runtime","common/vendor"]]]);